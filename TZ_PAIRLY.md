# Техническое задание: Pairly

**Версия:** 1.6  
**Дата:** 30.01.2026  
**Проект:** Веб-приложение и мобильные приложения для пар — совместный выбор фильмов

---

## 1. Общее описание

### 1.1 Название и концепция

**Pairly** — веб-приложение и мобильные приложения (iOS и Android) для пар, в котором пользователи могут вместе формировать список фильмов к просмотру, оценивать их и отслеживать пересечения своих предпочтений. **Веб-версия входит в MVP**, мобильные приложения планируются на более поздних этапах.

### 1.2 Целевая аудитория

- Пары (романтические, друзья, соседи), которые смотрят фильмы вместе
- Пользователи, которым важно согласовывать выбор контента с партнёром

### 1.3 Ключевая ценность

- Персональные списки «Буду смотреть» и обзор списка партнёра  
- Поиск фильмов по названию через внешний API  
- Страница пересечений — фильмы, которые оба добавили; быстрый способ выбрать, что смотреть вместе  

---

## 2. Функциональные требования

### 2.1 Регистрация и авторизация

| ID | Требование | Приоритет |
|----|------------|-----------|
| AUTH-01 | Регистрация по email + пароль | Must |
| AUTH-02 | Вход по email + пароль | Must |
| AUTH-03 | Восстановление пароля (reset password) | Не в MVP |
| AUTH-04 | Выход из аккаунта | Must |
| AUTH-05 | Вход через Apple / Google (OAuth) | Не в MVP |

**Данные пользователя при регистрации:**
- Email (уникальный)
- Пароль (минимальные требования: минимум 8 символов, минимум 1 буква и 1 цифра или специальный символ; блок-лист простых паролей опционален для MVP)
- Имя (отображаемое имя, не обязательно уникальное, редактирование не предусмотрено в MVP)

### 2.2 Пары (Pair / Couple)

| ID | Требование | Приоритет |
|----|------------|-----------|
| PAIR-01 | Добавление второго пользователя в пару | Must |
| PAIR-02 | Механика «приглашения»: код пары (6 цифр) — один показывает код, второй вводит в приложении | Must |
| PAIR-03 | После ввода кода пользователь B автоматически присоединяется к паре (подтверждение не требуется) | Must |
| PAIR-04 | В один момент у пользователя не более одной активной пары | Must |
| PAIR-05 | Возможность выйти из пары (расформирование) | Must |
| PAIR-06 | При выходе из пары: личный список «Буду смотреть» сохраняется у каждого пользователя; пересечения удаляются (экран «Пересечения» становится недоступен; пересечения вычисляются по двум спискам и отдельно не хранятся) | Must |

**Механика инвайта (зафиксировано):**  
Код пары — 6 цифр (0-9), постоянный пока пара активна. Пользователь A генерирует/показывает код в приложении, пользователь B вводит этот код в своём приложении — после ввода кода пара автоматически формируется (без дополнительного подтверждения). Пользователь не может ввести код, если уже находится в активной паре.

### 2.3 Поиск фильмов

| ID | Требование | Приоритет |
|----|------------|-----------|
| MOVIE-01 | Поиск фильмов по названию | Must |
| MOVIE-02 | Источник данных — внешний API (см. раздел 5) | Must |
| MOVIE-03 | Отображение в результатах: название, год, постер, краткое описание | Must |
| MOVIE-04 | Переход к детальной карточке фильма (описание, год, жанры, рейтинг и т.д.) | Must |
| MOVIE-05 | Подгрузка при скролле (infinite scroll) | Must |
| MOVIE-06 | Обработка ошибок API (нет сети, 429, таймаут) и информативные сообщения пользователю | Must |

### 2.4 Список «Буду смотреть» (Watchlist)

**Модель (зафиксировано):** у каждого пользователя свой независимый персональный список «Буду смотреть». Отдельная страница — «Пересечения»: фильмы, которые **оба** добавили в свои списки (см. п. 2.6).

Доступные для просмотра представления:
- **Свой список** — персональный «Буду смотреть» пользователя (включая просмотренные фильмы);
- **Список партнёра** — персональный список второго участника пары (только просмотр, без редактирования; **только непросмотренные** фильмы);
- **Пересечения** — общий список фильмов, входящих в оба персональных списка (**только непросмотренные** фильмы).

**Пустые состояния:** При отсутствии фильмов в списках отображается минимальное сообщение об отсутствии данных.

| ID | Требование | Приоритет |
|----|------------|-----------|
| WL-01 | Добавление фильма из поиска/карточки в **свой** «Буду смотреть» | Must |
| WL-02 | Удаление фильма из своего «Буду смотреть» | Must |
| WL-03 | Персональные списки: у каждого пользователя свой список; добавление/удаление только в своём | Must |
| WL-04 | Отдельная страница «Пересечения» со списком фильмов, которые оба добавили (см. п. 2.6) | Must |
| WL-05 | Просмотр: свой список, список партнёра, список пересечений — три отдельных представления/экрана или вкладки | Must |
| WL-06 | Отображение в списках: постер, название, год | Must |
| WL-07 | Сортировка: по дате добавления, по названию, по рейтингу | Must |
| WL-08 | В списке партнёра отображаются только **непросмотренные** фильмы (см. RATE-06). Если у партнёра нет фильмов в watchlist или все фильмы просмотрены — показывать минимальное сообщение об отсутствии фильмов | Must |

### 2.5 Оценки и статус «Просмотрено»

**Логика «Просмотрено» (зафиксировано):**  
При постановке оценки фильм **автоматически** помечается как «Просмотрено». При снятии статуса «Просмотрено» оценка **удаляется** (оценка и «Просмотрено» связаны — нельзя иметь одно без другого). В общих списках (список партнёра, пересечения) просмотренные фильмы **не отображаются** — только непросмотренные. В списке партнёра отображаются только фильмы, которые **партнёр не просмотрел**. В пересечениях отображаются только фильмы, которые **оба ещё не просмотрели** (если хотя бы один из пары отметил фильм как «Просмотрено», он скрывается из пересечений). В своём персональном списке просмотренные фильмы отображаются отдельно или с визуальным отличием.

| ID | Требование | Приоритет |
|----|------------|-----------|
| RATE-01 | Пользователь может поставить оценку фильму из **своего** «Буду смотреть» (шкала 1–10 звёзд). Оценку нельзя поставить фильму, который не добавлен в свой watchlist | Must |
| RATE-02 | Шкала оценок — единая для проекта: 1–10 звёзд | Must |
| RATE-03 | Можно изменить оценку | Must |
| RATE-04 | При постановке оценки фильм **автоматически** помечается как «Просмотрено» | Must |
| RATE-05 | В своём персональном списке просмотренные фильмы отображаются отдельно или с визуальным отличием | Must |
| RATE-06 | В общих списках (список партнёра, пересечения) просмотренные фильмы **не отображаются** — только непросмотренные. В списке партнёра — только непросмотренные **партнёром**. В пересечениях — только непросмотренные **обоими** (если хотя бы один посмотрел, фильм скрывается) | Must |
| RATE-07 | Возможность снять «Просмотрено» (при снятии оценка **удаляется**) | Must |
| RATE-08 | Оценки хранятся **персонально** (у каждого своя оценка). Итог по паре — **среднее** оценок обоих (отображать на экране пересечений и при необходимости в карточке фильма) | Must |
| RATE-09 | При удалении фильма из watchlist удаляется вся связанная информация: запись из watchlist, оценка (если была), статус «Просмотрено» (если был) | Must |

### 2.6 Страница «Пересечения»

**Определение:** пересечения — фильмы, которые **оба** участника пары добавили в свои персональные списки «Буду смотреть» и **оба ещё не просмотрели**. Если хотя бы один из пары отметил фильм как «Просмотрено», он скрывается из пересечений. Отображаются на отдельной странице «Пересечения». При выходе из пары страница пересечений недоступна (пересечения не хранятся отдельно; см. PAIR-06).

| ID | Требование | Приоритет |
|----|------------|-----------|
| INT-01 | Отдельный экран «Пересечения» | Must |
| INT-02 | Отображаются фильмы, входящие в **оба** персональных списка «Буду смотреть» и **оба ещё не просмотренные** (если хотя бы один посмотрел, фильм скрывается; см. RATE-06) | Must |
| INT-03 | Отображение: постер, название, год; оценки каждого пользователя (если есть); **средняя оценка пары** (см. RATE-08) | Must |
| INT-04 | Из пересечений можно перейти в карточку фильма, поставить/изменить свою оценку (только если фильм в своём watchlist), отметить «Просмотрено» | Must |
| INT-05 | Если пересечений нет — минимальное сообщение об отсутствии пересечений | Must |
| INT-06 | Пересечения доступны только при активной паре; при расформировании пары экран скрывается или недоступен | Must |

### 2.7 Аватар пользователя

**Когда добавляется:** аватар не добавляется при регистрации; загрузка и смена аватара доступны только на странице профиля.

**Хранение (зафиксировано):** файлы на диске бэкенда в папке `uploads/avatars/`, отдача через Express (статическая папка или маршрут с проверкой). Ресайз на бэкенде до фиксированного размера (200×200) и сохранение в формате WebP — обязательно (меньше трафика и места).

**UI (зафиксировано):** на области аватара (логотипе) отображается текст «Изменить»; при нажатии открывается модальное окно с возможностью загрузки фото (выбор файла, кнопка загрузки).

| ID | Требование | Приоритет |
|----|------------|-----------|
| AVATAR-01 | Пользователь может загрузить аватар (фото профиля) | Must |
| AVATAR-02 | Хранение: файлы в папке бэкенда `uploads/avatars/`, отдача через Express | Must |
| AVATAR-03 | Обработка на бэкенде: ресайз до 200×200 пикселей, сохранение в формате WebP | Must |
| AVATAR-04 | На области аватара отображается текст «Изменить»; по нажатию открывается модалка с загрузкой фото | Must |
| AVATAR-05 | В ответе GET /api/auth/me возвращается поле avatar_url (URL или путь к аватару); при отсутствии — null | Must |
| AVATAR-06 | Допустимые форматы загрузки: JPEG, PNG, WebP; ограничение размера файла (например до 2 МБ) | Must |

### 2.8 Прочее

| ID | Требование | Приоритет |
|----|------------|-----------|
| MISC-01 | Профиль пользователя: отдельная страница профиля с отображением имени (не обязательно уникальное, редактирование не предусмотрено в MVP), email (только просмотр) и аватара (см. п. 2.7) | Must |
| MISC-02 | Настройки: уведомления (инвайты, активность в паре), язык, тема (светлая/тёмная) | Не в MVP |
| MISC-03 | Онбординг при первом запуске (что такое пары, списки, пересечения) | Не в MVP |

---

## 3. Нефункциональные требования

### 3.1 Платформы

**MVP:**
- **Веб-приложение:** современные браузеры (Chrome, Firefox, Safari, Edge последних версий); адаптивный дизайн для мобильных устройств  
- **Бэкенд:** развёртывание на сервере (VPS/облако), доступ по HTTPS

**Не в MVP (последующие фазы):**
- **iOS:** минимальная версия iOS 14 (или актуальная на момент разработки)  
- **Android:** минимальная версия API 24 (Android 7.0) или актуальная

### 3.2 Безопасность

- Пароли хранятся только в виде хеша (bcrypt/argon2)  
- Все запросы к API по HTTPS  
- JWT или аналог для аутентификации; refresh-токены рекомендуется  
- Внешний API-ключ (кино) хранится только на бэкенде, не в клиентских приложениях (веб/мобильные)

### 3.3 Производительность и доступность

- Поиск фильмов: ответ до 3 секунд при нормальной работе внешнего API  
- Страницы списков и пересечений: загрузка до 2 секунд  
- Обработка 429 от внешнего API (rate limit): повтор с backoff и понятное сообщение пользователю

### 3.4 Локализация

- На первом этапе — русский язык  
- Интерфейс должен быть готов к добавлению других языков (i18n)

---

## 4. Стек технологий (зафиксировано)

### 4.1 Клиентские приложения

**Веб-приложение (MVP):**  
**React (Next.js) + TypeScript**  
- Для MVP допустим SPA подход (SSR/SSG не критично, так как контент за логином)  
- Единый язык с бэкендом  
- Адаптивный дизайн для мобильных устройств  
- Большое сообщество и экосистема

**Мобильные приложения (после MVP):**  
**React Native (Expo) + TypeScript**  
- Один кодбаз для iOS и Android  
- Быстрый старт с Expo  
- Переиспользование логики с веб-версией (общие типы, утилиты)  
- TypeScript — единый язык с бэкендом и вебом  

### 4.2 Бэкенд

**Node.js (Express) + TypeScript**  
- Единый язык с клиентскими приложениями (веб и мобильные)  
- Удобно при fullstack-команде  
- Express выбран для MVP — минимализм, быстрый старт  
- REST API для веб и мобильных приложений  

### 4.3 База данных и кеш

- **PostgreSQL** — основные данные: пользователи, пары, инвайты, списки «Буду смотреть», оценки, «Просмотрено».  
- **Redis** — кеш ответов TMDB (поиск фильмов, детали), сессии, rate limiting.  

### 4.4 Внешний API для фильмов

**TMDB (The Movie Database)**  
- Бесплатный доступ по API-ключу  
- Поиск по названию: `GET /search/movie`  
- Детали фильма, постеры, жанры, рейтинги  
- Примерно 40 запросов в секунду; при превышении — 429  
- Документация: https://developer.themoviedb.org/docs  

**Резерв (по необходимости):** OMDb API — fallback при сбоях TMDB.

### 4.5 Тестирование

- **Наличие тестов обязательно** для MVP: без тестов код не считается готовым к мержу в основную ветку.
- **Бэкенд (Express):**
  - Юнит-тесты для бизнес-логики (сервисы, утилиты).
  - Интеграционные тесты для API (ключевые эндпоинты: auth, пары, watchlist, поиск фильмов).
  - Инструменты: Jest (или аналог), при необходимости Supertest для HTTP.
- **Фронтенд (Next.js):**
  - Юнит-тесты для утилит и хуков.
  - Тесты компонентов (React Testing Library) для критичных экранов/компонентов.
  - Инструменты: Jest, React Testing Library; при необходимости Playwright/Cypress для E2E — опционально на этапе MVP.
- **Запуск:** все тесты должны проходить одной командой (например, `npm test` в корне или в пакетах backend/frontend).

### 4.6 Инфраструктура и DevOps

- **Хостинг бэкенда и веб-приложения:** тот же сервер (VPS (DigitalOcean, Timeweb, Selectel) или PaaS (Railway, Render, Fly.io))  
- **Контейнеризация:** Docker + Docker Compose для бэкенда, веб-приложения, **PostgreSQL** и **Redis**  
- **CI (обязательно):** **GitHub Actions** — настроить на репозитории проекта в GitHub.
  - **Триггер:** при push и pull request в основную ветку (например, `main` / `master`).
  - **Шаги:** установка зависимостей, линт (ESLint и т.п.), запуск тестов бэкенда и фронтенда.
  - **Итог:** пайплайн считается успешным только если линт и все тесты проходят; иначе сборка помечается как failed.
  - Секреты (API-ключи, ключи БД и т.д.) хранить только в GitHub Secrets, не в коде и не в конфигах репозитория.
- **CD (деплой):** настройка деплоя через GitHub Actions или иной механизм — по решению команды; для MVP допустим ручной деплой при зелёном CI.
- **Мобильные приложения (после MVP):** сборка приложений (Expo) в CI на более поздних этапах.
- **Мониторинг:** логи, алерты при 5xx и падении внешнего API  

### 4.7 Сводная схема стека

```
┌─────────────────────────────────────────────────────────┐
│  Веб: React (Next.js) + TypeScript (MVP)                │
│  Браузеры, адаптивный дизайн                           │
└─────────────────────────┬───────────────────────────────┘
                          │ HTTPS / REST
                          ▼
┌─────────────────────────────────────────────────────────┐
│  Backend: Express (Node.js + TypeScript)                 │
│  - Auth (JWT)                                           │
│  - Users, Pairs, Invites (код пары)                     │
│  - Watchlist (персональные), Ratings, Watched           │
│  - Proxy to TMDB                                        │
└──────────┬─────────────────────┬────────────┬───────────┘
           │                     │            │
           ▼                     ▼            ▼
┌──────────────────┐  ┌──────────────┐  ┌─────────────────┐
│  PostgreSQL      │  │  Redis       │  │  TMDB API       │
│  Users, Pairs,   │  │  Кеш TMDB,   │  │  Search,        │
│  Watchlist,      │  │  сессии,     │  │  details,       │
│  Ratings,        │  │  rate limit  │  │  images         │
│  Watched         │  │              │  │                 │
└──────────────────┘  └──────────────┘  └─────────────────┘

┌─────────────────────────────────────────────────────────┐
│  Мобильные: React Native (Expo) + TypeScript            │
│  iOS & Android (после MVP)                              │
└─────────────────────────┬───────────────────────────────┘
                          │ HTTPS / REST
                          ▼
                    (тот же Backend)
```

---

## 5. Внешний API: TMDB — краткая спецификация

### 5.1 Регистрация и ключ

- Регистрация: https://www.themoviedb.org/signup  
- API-ключ в настройках аккаунта  
- Base URL: `https://api.themoviedb.org/3`

### 5.2 Основные эндпоинты

| Метод | Эндпоинт | Назначение |
|-------|----------|------------|
| GET | `/search/movie?query={title}&page={n}` | Поиск по названию |
| GET | `/movie/{id}` | Детали фильма |
| GET | `/movie/{id}/images` | Постеры и т.д. |
| GET | `/configuration` | Базовый URL для картинок |

### 5.3 Использование на бэкенде

- Все запросы к TMDB выполняет **только бэкенд**  
- API-ключ хранится в переменных окружения сервера  
- Кеширование ответов в **Redis** (см. п. 4.3) по `(query, page)` и `movie_id` для снижения количества запросов и риска 429  
- Язык и регион: `language=ru-RU`, `region=RU` для всех запросов  
- TTL кеша: поиск — 1 час, детали фильма — 24 часа, configuration — 7 дней  
- Размеры постеров: списки — `w500`, карточка — `w780`, миниатюры — `w300`  

---

## 6. Экраны/страницы приложения (MVP)

**Веб-приложение (MVP):**

1. **Старт:** Вход / Регистрация  
2. **Приглашение в пару:** Генерация/показ кода пары (6 цифр) или ввод кода для присоединения  
3. **Поиск фильмов:** Поле ввода, результаты, карточка фильма, добавление в **свой** «Буду смотреть»  
4. **Мой список «Буду смотреть»:** Персональный список, оценки (1–10), «Просмотрено», удаление  
5. **Список партнёра:** Только просмотр персонального списка партнёра (без редактирования), только непросмотренные партнёром фильмы  
6. **Пересечения:** Список фильмов, которые оба добавили и оба ещё не просмотрели; оценки каждого и среднее; переход в карточку, «Просмотрено»  
7. **Профиль:** Отдельная страница с отображением имени и email (только просмотр, редактирование не предусмотрено), выход из аккаунта

**Примечание:** После входа выполняется редирект на watchlist/поиск, отдельной главной страницы нет.

**Примечание:** Адаптивный дизайн для мобильных устройств (responsive), но нативное мобильное приложение (iOS/Android) планируется на более поздних этапах.  

---

## 7. Этапы разработки (высокоуровнево)

### Фаза 1: MVP — Веб-приложение (2–3 месяца)

- **Веб-приложение (React/Next.js):**
  - Регистрация, вход (email + пароль)  
  - Инвайты в пару по **коду** (6 цифр) — автоматическое присоединение после ввода кода  
  - Поиск фильмов (TMDB), добавление в **свой** «Буду смотреть»  
  - Персональные списки «Буду смотреть»; просмотр своего, партнёра и пересечений  
  - Оценки (1–10), автоматическое «Просмотрено» при оценке  
  - В общих списках (партнёр, пересечения) — только непросмотренные фильмы  
  - Страница «Пересечения» (фильмы в обоих списках, которые оба ещё не просмотрели, средняя оценка пары)  
  - Выход из пары: сохранение личных списков, недоступность пересечений  
  - Профиль пользователя (аватар с загрузкой по «Изменить», просмотр имени и email)  
  - Адаптивный дизайн для мобильных устройств  
  - Тесты (бэкенд и фронтенд) и CI на GitHub Actions (линт + тесты при push/PR)

### Фаза 2: Улучшения веба (1–2 месяца)

- OAuth (Apple, Google)  
- Восстановление пароля  
- Инвайт по email + email-уведомления (опционально)  
- Улучшение UX (онбординг, пустые состояния, подсказки)  
- Настройки (тема, язык, уведомления)  
- PWA (Progressive Web App) — установка на мобильные устройства

### Фаза 3: Мобильные приложения (2–3 месяца)

- **React Native (Expo) для iOS и Android:**
  - Портируем функционал веб-версии в мобильные приложения  
  - Push-уведомления (инвайты, активность в паре)  
  - Нативная оптимизация UX для мобильных платформ

### Фаза 4: Расширение (по приоритетам)

- Рекомендации на основе оценок  
- Экспорт списка, шаринг  

---

## 8. Риски и митигация

| Риск | Митигация |
|------|-----------|
| Изменение или отказ TMDB API | Абстракция «кино-провайдера» в бэкенде; при необходимости подключение OMDb или другого API |
| 429 от TMDB | Кеш, backoff, очередь запросов; понятные сообщения пользователю |
| Производительность расчёта пересечений при больших списках | Пересечения = выборка по двум спискам; индексы, кеш при необходимости |

---

## 9. Зафиксированные решения

- **Платформы (MVP):** веб-приложение (React/Next.js, SPA подход); мобильные приложения (iOS/Android) на более поздних этапах.  
- **Авторизация (MVP):** email + пароль (минимум 8 символов, буква + цифра); OAuth и восстановление пароля — не в MVP.  
- **Данные пользователя:** email (уникальный), пароль, имя (не уникальное, редактирование не предусмотрено в MVP), аватар (не при регистрации; загрузка только в профиле — uploads/avatars/, ресайз 200×200, WebP; на UI — текст «Изменить» на аватаре, модалка загрузки).  
- **Модель списков:** персональные списки «Буду смотреть» у каждого пользователя; просмотр своего, партнёра и пересечений.  
- **Механика инвайта (MVP):** код пары — 6 цифр (0-9), постоянный пока пара активна; один показывает, второй вводит — после ввода кода пара автоматически формируется (без подтверждения). Пользователь не может ввести код, если уже в паре.  
- **Шкала оценок:** 1–10 звёзд; оценки персональные, итог по паре — среднее. Оценку можно поставить только фильму из своего watchlist.  
- **«Просмотрено»:** при постановке оценки фильм автоматически помечается как «Просмотрено». При снятии «Просмотрено» оценка удаляется. В общих списках (партнёр, пересечения) просмотренные фильмы не отображаются — только непросмотренные. В списке партнёра — только непросмотренные партнёром. В пересечениях — только непросмотренные обоими (если хотя бы один посмотрел, фильм скрывается). В своём списке просмотренные отображаются отдельно или с визуальным отличием.  
- **Выход из пары:** личные списки сохраняются; пересечения перестают отображаться (экран недоступен), отдельно не хранятся.  
- **Бэкенд:** Express.js (не NestJS) для MVP.  
- **TMDB:** русский язык и регион, кеш с TTL (поиск — 1ч, детали — 24ч, configuration — 7 дней).  
- **Тесты и CI:** написание тестов (юнит и интеграционные для бэкенда, юнит и компонентные для фронтенда) обязательно. CI — GitHub Actions: линт и тесты при push/PR в основную ветку; секреты только в GitHub Secrets.

---

## 10. Глоссарий

- **Пара (Pair):** два пользователя, связанные через ввод кода пары (6 цифр); пара формируется автоматически после ввода кода.  
- **Буду смотреть (Watchlist):** персональный список фильмов, которые пользователь планирует посмотреть; у каждого свой.  
- **Пересечения:** фильмы, входящие в «Буду смотреть» **обоих** участников пары и **оба ещё не просмотренные** (если хотя бы один посмотрел, фильм скрывается); отображаются на отдельной странице, при расформировании пары недоступны.  
- **Просмотрено:** персональная отметка о том, что фильм уже просмотрен (связка пользователь–фильм в БД). При постановке оценки фильм автоматически помечается как «Просмотрено».

---

*Конец ТЗ. Документ предназначен для согласования с заказчиком и командой разработки перед стартом реализации.*
