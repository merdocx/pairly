# Деплой (pairlyapp.ru)

## Почему на главной только «Загрузка»

Главная страница проверяет авторизацию запросом `/api/auth/me`. Если бэкенд недоступен или не отвечает, запрос зависает и пользователь видит только «Загрузка».

**Что сделано в коде:**
- Таймаут запросов к API — 15 секунд. Если бэкенд не ответил, показывается сообщение «Сервер не отвечает. Попробуйте позже.» и редирект на страницу входа.
- URL бэкенда для прокси задаётся переменной окружения (см. ниже).

## Переменные окружения на сервере (Next.js)

На машине, где запущен Next.js (фронт), задайте:

| Переменная | Описание |
|------------|----------|
| `API_BACKEND_URL` | URL бэкенда для прокси запросов `/api/*`. По умолчанию `http://127.0.0.1:4000`. |

**Примеры:**
- Бэкенд на том же сервере: `API_BACKEND_URL=http://127.0.0.1:4000` (или не задавать).
- Бэкенд на другом хосте: `API_BACKEND_URL=https://api.pairlyapp.ru` или `http://internal-host:4000`.

После изменения переменной перезапустите процесс Next.js (`npm run start` или ваш способ запуска).

## Sign in with Apple (бэкенд)

Чтобы работала кнопка «Войти через Apple», на сервере с бэкендом задайте переменные окружения (из Apple Developer):

| Переменная | Описание |
|------------|----------|
| `APPLE_CLIENT_ID` | Services ID (например `ru.pairlyapp.service`) |
| `APPLE_TEAM_ID` | Team ID из Apple Developer |
| `APPLE_KEY_ID` | Key ID созданного ключа для Sign in with Apple |
| `APPLE_PRIVATE_KEY` | Содержимое .p8 файла (при необходимости замените переводы строк на `\n`) |
| `APPLE_REDIRECT_URI` | Полный URL callback, например `https://pairlyapp.ru/api/auth/apple/callback` (должен совпадать с настройками в Apple) |

**Подробная инструкция:** [APPLE_SIGNIN_SETUP.md](./APPLE_SIGNIN_SETUP.md) — пошаговая настройка в Apple Developer (Services ID, ключ, домены, Return URL).

## Проверка

1. Убедитесь, что бэкенд запущен и отвечает (например, `curl -s https://pairlyapp.ru/api/health` или аналог).
2. Откройте https://pairlyapp.ru — при недоступном бэкенде через ~15 секунд должно появиться сообщение об ошибке и переход на страницу входа.
