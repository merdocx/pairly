# –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏: –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, —Ç–µ—Å—Ç—ã

**–î–∞—Ç–∞:** 28.01.2026  
**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 29.01.2026 (–ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑)  
**–í–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞:** 0.3.0  

---

## –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑: –∏—Ç–æ–≥

**–°–¥–µ–ª–∞–Ω–æ (–≤—Å–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –ø—É–Ω–∫—Ç—ã):**

- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** —É–±—Ä–∞–Ω—ã 2N –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ intersections, –ø–æ–¥–∫–ª—é—á—ë–Ω `compression`, –¥–ª—è GET /api/movies/:id –∑–∞–¥–∞–Ω Cache-Control.
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** rate limit, helmet, –≤–∞–ª–∏–¥–∞—Ü–∏—è AppError –≤ movies.
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –≤ errorHandler –ª–æ–≥–∏—Ä—É—é—Ç—Å—è timestamp –∏ stack –¥–ª—è 500.
- **CI:** —Ç–µ—Å—Ç—ã backend –∏ web –≤ GitHub Actions; JUnit-–æ—Ç—á—ë—Ç—ã –ø—É–±–ª–∏–∫—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `mikepenz/action-junit-report` ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–∏–¥–Ω—ã –≤ Checks (—Ä–∞–∑–¥–µ–ª Tests).

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ (–æ—Å—Ç–∞–≤—à–∏–µ—Å—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏):**

- **httpOnly cookie –¥–ª—è JWT:** –±—ç–∫–µ–Ω–¥ –≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç cookie `pairly_token` (httpOnly, secure –≤ prod), auth —á–∏—Ç–∞–µ—Ç —Ç–æ–∫–µ–Ω –∏–∑ cookie –∏–ª–∏ Authorization; —Ñ—Ä–æ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `credentials: 'include'`, –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è POST /api/auth/logout –¥–ª—è —Å–±—Ä–æ—Å–∞ cookie.
- **Zod-–≤–∞–ª–∏–¥–∞—Ü–∏—è `sort` –≤ watchlist:** –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è ‚Äî `added_at` | `rating` | `title`, –∏–Ω–∞—á–µ fallback `added_at`.
- **–î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è title/poster:** –º–∏–≥—Ä–∞—Ü–∏—è `002_watchlist_denorm.sql` –¥–æ–±–∞–≤–ª—è–µ—Ç –∫–æ–ª–æ–Ω–∫–∏ title, release_date, poster_path –≤ watchlist; –ø—Ä–∏ POST /me —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –∏–∑ TMDB; GET /me, /partner, /intersections –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∏—Ö –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ (–±–µ–∑ –≤—ã–∑–æ–≤–∞ getMovieDetail).
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:** –≤ pool –æ–±—ë—Ä—Ç–∫–∞ –≤–æ–∫—Ä—É–≥ query –ª–æ–≥–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –¥–æ–ª—å—à–µ 500 ms (timestamp + –ø—Ä–µ–≤—å—é —Ç–µ–∫—Å—Ç–∞).
- **.env.example:** –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø—Ä–æ JWT_SECRET –∏ WEB_ORIGIN –≤ –ø—Ä–æ–¥–µ.

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ø—Ä–æ–¥–µ (—Ç–æ–ª—å–∫–æ –≤—Ä—É—á–Ω—É—é):** JWT_SECRET, WEB_ORIGIN (CORS), `max_connections` –≤ PostgreSQL.

---

## 1. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –°–¥–µ–ª–∞–Ω–æ

- **Rate limiting** ‚Äî –≤–∫–ª—é—á—ë–Ω `express-rate-limit`: auth 20 –∑–∞–ø—Ä–æ—Å–æ–≤/15 –º–∏–Ω, API 120/–º–∏–Ω. –û—Ç–≤–µ—Ç 429 –≤ JSON.
- **Helmet** ‚Äî –≤–∫–ª—é—á—ë–Ω —Å `crossOriginResourcePolicy: 'cross-origin'`, CSP –æ—Ç–∫–ª—é—á—ë–Ω –≤–æ –∏–∑–±–µ–∂–∞–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å–æ —Å–∫—Ä–∏–ø—Ç–∞–º–∏/—Å—Ç–∏–ª—è–º–∏.
- **–í–∞–ª–∏–¥–∞—Ü–∏—è** ‚Äî –≤ movies —Ä–æ—É—Ç–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ `AppError` –≤ `next(e)`, —á—Ç–æ–±—ã 400 –Ω–µ –ø—Ä–µ–≤—Ä–∞—â–∞–ª–∏—Å—å –≤ 502.

### –ö—Ä–∏—Ç–∏—á–Ω–æ (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ø—Ä–æ–¥–µ)

- **JWT_SECRET** ‚Äî –≤ –∫–æ–¥–µ –µ—Å—Ç—å fallback `'dev-secret-change-in-production'`. –í –ø—Ä–æ–¥–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∑–∞–¥–∞–≤–∞—Ç—å —Å–≤–æ–π –¥–ª–∏–Ω–Ω—ã–π —Å–ª—É—á–∞–π–Ω—ã–π `JWT_SECRET` –≤ `.env`. **–ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –≤ prod** –±—ç–∫–µ–Ω–¥ –ø–∏—à–µ—Ç –≤ –ª–æ–≥ `[SECURITY] –í –ø—Ä–æ–¥–µ –∑–∞–¥–∞–π—Ç–µ —Å–≤–æ–π –¥–ª–∏–Ω–Ω—ã–π —Å–ª—É—á–∞–π–Ω—ã–π JWT_SECRET`, –µ—Å–ª–∏ —Å–µ–∫—Ä–µ—Ç –Ω–µ –∑–∞–¥–∞–Ω –∏–ª–∏ —Ä–∞–≤–µ–Ω –¥–µ—Ñ–æ–ª—Ç—É.
- **CORS (WEB_ORIGIN)** ‚Äî –≤ –ø—Ä–æ–¥–µ `WEB_ORIGIN` –Ω–µ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å `*`, —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –¥–æ–º–µ–Ω—ã —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é. **–ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –≤ prod** –±—ç–∫–µ–Ω–¥ –ø–∏—à–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –≤ –ª–æ–≥, –µ—Å–ª–∏ `WEB_ORIGIN` —Å–æ–¥–µ—Ä–∂–∏—Ç `*` –∏–ª–∏ –ø—É—Å—Ç–æ–π.

### –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ (–≤—ã–ø–æ–ª–Ω–µ–Ω–æ)

- ~~**–¢–æ–∫–µ–Ω –≤ localStorage**~~ **–°–¥–µ–ª–∞–Ω–æ.** JWT –≤—ã–¥–∞—ë—Ç—Å—è –≤ httpOnly cookie `pairly_token` (secure –≤ prod), auth —á–∏—Ç–∞–µ—Ç –∏–∑ cookie –∏–ª–∏ Authorization; —Ñ—Ä–æ–Ω—Ç —Å `credentials: 'include'`, logout —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç cookie.
- ~~**–í–∞–ª–∏–¥–∞—Ü–∏—è**~~ **–°–¥–µ–ª–∞–Ω–æ.** –í watchlist `sort` –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ Zod (`added_at` | `rating` | `title`), –∏–Ω–∞—á–µ fallback. Auth, watchlist body, movies ‚Äî Zod/safeParse —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è.

---

## 2. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑)

### 2.1 –ë—ç–∫–µ–Ω–¥: Watchlist –∏ N+1

**–¢–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**

- **GET /api/watchlist/me** ‚Äî –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏ —Å–ø–∏—Å–∫–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `getMovieDetail(movie_id)`. –ü—Ä–∏ 50 —Ñ–∏–ª—å–º–∞—Ö: –¥–æ 50 –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ Redis (–∏–ª–∏ TMDB –ø—Ä–∏ –ø—Ä–æ–º–∞—Ö–µ). Redis –∫—ç—à–∏—Ä—É–µ—Ç –¥–µ—Ç–∞–ª–∏ –Ω–∞ 24 —á ‚Äî –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö –ø—Ä–æ–º–∞—Ö–æ–≤ –º–µ–Ω—å—à–µ, –Ω–æ –ø–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ –∫—ç—à–∞ —Ç—è–∂—ë–ª—ã–π.
- **GET /api/watchlist/partner** ‚Äî —Ç–æ –∂–µ: N –≤—ã–∑–æ–≤–æ–≤ `getMovieDetail`.
- **GET /api/watchlist/intersections** ‚Äî N –≤—ã–∑–æ–≤–æ–≤ `getMovieDetail` –ø–ª—é—Å **2N –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î** (–Ω–∞ –∫–∞–∂–¥—ã–π —Ñ–∏–ª—å–º –¥–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö `SELECT rating` ‚Äî –ø–æ user –∏ –ø–æ partner). –ü—Ä–∏ 20 –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è—Ö: 20 –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ TMDB/Redis + 40 –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ PostgreSQL.

**–í–∞–∂–Ω–æ–µ —É—Ç–æ—á–Ω–µ–Ω–∏–µ –ø–æ intersections:**

SQL –¥–ª—è –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π —É–∂–µ –∏—Å–∫–ª—é—á–∞–µ—Ç —Ñ–∏–ª—å–º—ã, —É –∫–æ—Ç–æ—Ä—ã—Ö –µ—Å—Ç—å —Ä–µ–π—Ç–∏–Ω–≥ —É –ª—é–±–æ–≥–æ –∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
`AND NOT EXISTS (SELECT 1 FROM ratings r WHERE r.user_id = $1 AND r.movie_id = w.movie_id) AND NOT EXISTS (... user_b ...)`.
–ó–Ω–∞—á–∏—Ç, –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Ä–µ–π—Ç–∏–Ω–≥–∏ –≤—Å–µ–≥–¥–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç. –¢–µ–∫—É—â–∏–µ 2N –∑–∞–ø—Ä–æ—Å–æ–≤ `SELECT rating` –∏–∑–±—ã—Ç–æ—á–Ω—ã ‚Äî –æ–Ω–∏ –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**

1. **–ë—ã—Å—Ç—Ä—ã–π –≤—ã–∏–≥—Ä—ã—à: —É–±—Ä–∞—Ç—å 2N –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ intersections**  
   –í `GET /api/watchlist/intersections` –Ω–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã —Ä–µ–π—Ç–∏–Ω–≥–æ–≤: –¥–ª—è –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö —Å—Ç—Ä–æ–∫ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ –Ω–µ—Ç –ø–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—é. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `my_rating`, `partner_rating`, `average_rating` –≤ `null`. –≠—Ç–æ —Å—Ä–∞–∑—É —É–±–∏—Ä–∞–µ—Ç 2N round-trip –∫ –ë–î –∏ —É–ø—Ä–æ—â–∞–µ—Ç –∫–æ–¥.

2. **–ü–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è: –±–∞—Ç—á-–∑–∞–ø—Ä–æ—Å —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ (–µ—Å–ª–∏ –ø–æ—è–≤—è—Ç—Å—è ¬´–ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è —Å —Ä–µ–π—Ç–∏–Ω–≥–∞–º–∏¬ª)**  
   –ï—Å–ª–∏ –≤ –±—É–¥—É—â–µ–º –ª–æ–≥–∏–∫–∞ –∏–∑–º–µ–Ω–∏—Ç—Å—è –∏ –≤ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è –ø–æ–ø–∞–¥—É—Ç —Ñ–∏–ª—å–º—ã —Å —Ä–µ–π—Ç–∏–Ω–≥–∞–º–∏ ‚Äî –≤–º–µ—Å—Ç–æ 2 –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –∫–∞–∂–¥—ã–π —Ñ–∏–ª—å–º –¥–µ–ª–∞—Ç—å –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –ø–æ –≤—Å–µ–º –ø–∞—Ä–∞–º –¥–ª—è user –∏ –æ–¥–∏–Ω –¥–ª—è partner:  
   `SELECT movie_id, rating FROM ratings WHERE user_id = $1 AND movie_id = ANY($2)` –∏ —Ç–æ –∂–µ –¥–ª—è partnerId. –í —Ç–∞–±–ª–∏—Ü–µ `ratings` —É–∂–µ –µ—Å—Ç—å UNIQUE(user_id, movie_id), –∏–Ω–¥–µ–∫—Å –ø–æ (user_id, movie_id) —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω –¥–ª—è —Ç–∞–∫–æ–≥–æ –±–∞—Ç—á–∞.

3. **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–æ–≤**  
   –•—Ä–∞–Ω–∏—Ç—å –≤ –ë–î (–∏–ª–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ) `title`, `release_date`, `poster_path` –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ watchlist (–¥–∞–Ω–Ω—ã–µ –∏–∑ TMDB –Ω–∞ –º–æ–º–µ–Ω—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è). –¢–æ–≥–¥–∞ –¥–ª—è —Å–ø–∏—Å–∫–æ–≤ –Ω–µ –Ω—É–∂–Ω—ã –≤—ã–∑–æ–≤—ã getMovieDetail ‚Äî —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –∫ –ë–î. –ú–∏–Ω—É—Å: –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç —É—Å—Ç–∞—Ä–µ—Ç—å; –ø–ª—é—Å: –±—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç –∏ –º–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ TMDB/Redis.

4. **–ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º**  
   –°–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `Promise.all(rows.map(...))` ‚Äî –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –≤—ã–∑–æ–≤—ã –∫ Redis/TMDB, —á—Ç–æ —Ö–æ—Ä–æ—à–æ. –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, p-limit) –∏–º–µ–µ—Ç —Å–º—ã—Å–ª —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–∞—Ö (100+), —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å TMDB.

### 2.2 –ë—ç–∫–µ–Ω–¥: —Å–∂–∞—Ç–∏–µ –∏ –∫—ç—à HTTP

- **–°–∂–∞—Ç–∏–µ –æ—Ç–≤–µ—Ç–æ–≤** ‚Äî JSON –æ—Ç API –º–æ–∂–Ω–æ —Å–∂–∏–º–∞—Ç—å gzip/brotli. –ü–æ–¥–∫–ª—é—á–∏—Ç—å middleware `compression` –≤ Express: `npm i compression`, –∑–∞—Ç–µ–º `app.use(compression())` –¥–æ –º–∞—Ä—à—Ä—É—Ç–æ–≤. –£–º–µ–Ω—å—à–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ –≤ 3‚Äì10 —Ä–∞–∑ –¥–ª—è —Å–ø–∏—Å–∫–æ–≤ –∏ –ø–æ–∏—Å–∫–∞.
- **Cache-Control** ‚Äî –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏:
  - `GET /api/movies/search?q=...` ‚Äî –∫–æ—Ä–æ—Ç–∫–∏–π –∫—ç—à –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –∏–ª–∏ –ø—Ä–æ–∫—Å–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `private, max-age=60`) –∏–ª–∏ –Ω–µ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å –∏–∑-–∑–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –∫—É–∫–∏/—Ç–æ–∫–µ–Ω.
  - `GET /api/movies/:id` ‚Äî –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ CDN/–ø—Ä–æ–∫—Å–∏ –º–æ–∂–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å –ø–æ id (–Ω–∞–ø—Ä–∏–º–µ—Ä, `public, max-age=3600`), —Ç.–∫. –¥–µ—Ç–∞–ª–∏ —Ñ–∏–ª—å–º–∞ –º–µ–Ω—è—é—Ç—Å—è —Ä–µ–¥–∫–æ.

### 2.3 –ë—ç–∫–µ–Ω–¥: –ë–î –∏ Redis

- **–ü—É–ª PostgreSQL** ‚Äî `max: 20` –≤ pool ‚Äî —Ä–∞–∑—É–º–Ω–æ. –°–≤–µ—Ä–∏—Ç—å —Å `max_connections` –≤ PostgreSQL (–æ–±—ã—á–Ω–æ 100), —á—Ç–æ–±—ã —Å—É–º–º–∞ –ø—É–ª–æ–≤ –≤—Å–µ—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –Ω–µ –ø—Ä–µ–≤—ã—à–∞–ª–∞ –ª–∏–º–∏—Ç.
- **Redis** ‚Äî –∫–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞—ë—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ (singleton) ‚Äî —Ö–æ—Ä–æ—à–æ. –ü—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ Redis –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ TMDB –ø–æ–π–¥—É—Ç –Ω–∞–ø—Ä—è–º—É—é; –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ–±–∞–≤–∏—Ç—å fallback (–±–µ–∑ –∫—ç—à–∞) –∏–ª–∏ –±—ã—Å—Ç—Ä—ã–π fail.
- **getConfiguration()** ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ –∫–∞–∂–¥–æ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ watchlist (me, partner, intersections); —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫—ç—à–∏—Ä—É–µ—Ç—Å—è –≤ Redis –Ω–∞ 7 –¥–Ω–µ–π ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ TMDB –Ω–µ —Å–æ–∑–¥–∞—ë—Ç.

### 2.4 –§—Ä–æ–Ω—Ç–µ–Ω–¥

- **next/image** ‚Äî –ø–æ—Å—Ç–µ—Ä—ã –ø–µ—Ä–µ–≤–µ–¥–µ–Ω—ã –Ω–∞ `PosterImage` —Å next/image, –¥–æ–º–µ–Ω `image.tmdb.org` –≤ `remotePatterns` ‚Äî —Ö–æ—Ä–æ—à–æ –¥–ª—è LCP –∏ —Ñ–æ—Ä–º–∞—Ç–æ–≤.
- **–ö—ç—à –≤–∫–ª–∞–¥–æ–∫** ‚Äî —Å–ø–∏—Å–∫–∏ (–ú–æ–µ / –ü–∞—Ä—Ç–Ω–µ—Ä–∞ / –û–±—â–µ–µ) –Ω–µ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤–∫–ª–∞–¥–æ–∫ ‚Äî –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è, –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å –Ω–µ —É—Ö–æ–¥–∏—Ç. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ.
- **–†–∞–∑–º–µ—Ä –±–∞–Ω–¥–ª–∞** ‚Äî First Load JS ~88‚Äì103 kB ‚Äî –ø—Ä–∏–µ–º–ª–µ–º–æ. –ü—Ä–∏ —Ä–æ—Å—Ç–µ ‚Äî –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç —Ç—è–∂—ë–ª—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–∞—Ä—Ç–æ—á–∫–∞ —Ñ–∏–ª—å–º–∞).
- **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤** ‚Äî –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –ø—É—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/api/watchlist/me`) –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –¥–≤–∞–∂–¥—ã. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –æ–±—â–∏–π —Å–ª–æ–π (SWR/React Query) —Å –∫—ç—à–µ–º –ø–æ –∫–ª—é—á—É –∑–∞–ø—Ä–æ—Å–∞.

### 2.5 –°–≤–æ–¥–∫–∞ –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

| –£–∑–∫–æ–µ –º–µ—Å—Ç–æ | –í–ª–∏—è–Ω–∏–µ | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è | –°—Ç–∞—Ç—É—Å |
|-------------|---------|--------------|--------|
| Intersections: 2N –∑–∞–ø—Ä–æ—Å–æ–≤ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ –∫ –ë–î | –í—ã—Å–æ–∫–æ–µ –ø—Ä–∏ N > 10 | –£–±—Ä–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã (—Ä–µ–π—Ç–∏–Ω–≥–∏ –ø–æ –ª–æ–≥–∏–∫–µ –≤—Å–µ–≥–¥–∞ null) | ‚úÖ –°–¥–µ–ª–∞–Ω–æ |
| Watchlist: N –≤—ã–∑–æ–≤–æ–≤ getMovieDetail | –°—Ä–µ–¥–Ω–µ–µ (Redis —Å–º—è–≥—á–∞–µ—Ç) | –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è title/poster –≤ –ë–î | üî≤ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ |
| –ù–µ—Ç gzip –¥–ª—è JSON | –°—Ä–µ–¥–Ω–µ–µ (—Ç—Ä–∞—Ñ–∏–∫) | Middleware `compression` | ‚úÖ –°–¥–µ–ª–∞–Ω–æ |
| –ù–µ—Ç Cache-Control –¥–ª—è movies | –ù–∏–∑–∫–æ–µ | –ó–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è /api/movies/:id | ‚úÖ –°–¥–µ–ª–∞–Ω–æ |

---

## 3. –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

### –°–¥–µ–ª–∞–Ω–æ

- **Backend:**  
  - `health.test.ts` ‚Äî GET /api/health  
  - `auth.validation.test.ts` ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è register/login (400)  
  - `auth.401.test.ts` ‚Äî 401 –±–µ–∑ —Ç–æ–∫–µ–Ω–∞ –∏ —Å –Ω–µ–≤–µ—Ä–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º –¥–ª—è /api/pairs, /api/watchlist/me (GET/POST)  
  - `movies.test.ts` ‚Äî –ø–æ–∏—Å–∫ –±–µ–∑ q (–ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç), –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π id (400)  
  - `errorHandler.test.ts` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫  
  - –í —Ä–æ—É—Ç–µ movies: –ø–µ—Ä–µ–¥–∞—á–∞ `AppError` –≤ next(e), —á—Ç–æ–±—ã 400 –Ω–µ –ø—Ä–µ–≤—Ä–∞—â–∞–ª—Å—è –≤ 502  

- **Web:**  
  - `api.test.ts` ‚Äî getApiUrl, getErrorMessage  

- **CI (GitHub Actions):** –≤ workflow –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è `npm run test` –¥–ª—è backend –∏ web –±–µ–∑ –ë–î/Redis; JUnit-–æ—Ç—á—ë—Ç—ã –ø—É–±–ª–∏–∫—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `mikepenz/action-junit-report` ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ —Ä–∞–∑–¥–µ–ª–µ Checks (Tests) —É run.

### –û—Å—Ç–∞—ë—Ç—Å—è (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)

1. **Backend (–ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î –≤ CI)**  
   –£—Å–ø–µ—à–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π: register ‚Üí login ‚Üí —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ.  
   –ü–∞—Ä—ã: —Å–æ–∑–¥–∞–Ω–∏–µ –ø–∞—Ä—ã, –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ –∫–æ–¥—É, –≤—ã—Ö–æ–¥; 404 –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø–∞—Ä—ã –¥–ª—è partner/intersections.  
   Watchlist: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ/–æ—Ü–µ–Ω–∫–∞; –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–æ–ª—è—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

2. **Backend –±–µ–∑ –ë–î**  
   –ú–æ–∫–∏—Ä–æ–≤–∞—Ç—å pool (–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å in-memory SQLite –¥–ª—è —Ç–µ—Å—Ç–æ–≤) –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –ø–∞—Ä –∏ watchlist.

3. **Web**  
   –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã —É—Ç–∏–ª–∏—Ç –∏ —Ö—É–∫–æ–≤.  
   –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (React Testing Library), E2E (Playwright/Cypress).

4. **CI**  
   –°–µ–π—á–∞—Å —Ç–µ—Å—Ç—ã backend –Ω–µ —Ç—Ä–µ–±—É—é—Ç –ë–î (health, validation, 401, movies –±–µ–∑ TMDB). –î–ª—è —Ç–µ—Å—Ç–æ–≤ —Å –ë–î ‚Äî —Å–µ—Ä–≤–∏—Å PostgreSQL –≤ GitHub Actions –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ DATABASE_URL, JWT_SECRET.

---

## 4. –ö—Ä–∞—Ç–∫–∏–π —á–µ–∫-–ª–∏—Å—Ç

| –û–±–ª–∞—Å—Ç—å | –î–µ–π—Å—Ç–≤–∏–µ | –°—Ç–∞—Ç—É—Å |
|---------|----------|--------|
| –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å | Rate limit, helmet, httpOnly cookie, Zod, JWT_SECRET –∏ CORS –≤ –ø—Ä–æ–¥–µ | ‚úÖ –í –∫–æ–¥–µ –≤—Å—ë —Å–¥–µ–ª–∞–Ω–æ; –≤ –ø—Ä–æ–¥–µ –≤—Ä—É—á–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∏—Ç—å JWT_SECRET –∏ WEB_ORIGIN |
| –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è | next/image, –∫—ç—à –≤–∫–ª–∞–¥–æ–∫ | ‚úÖ –°–¥–µ–ª–∞–Ω–æ |
| –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –£–±—Ä–∞—Ç—å 2N –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ intersections, compression, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è | ‚úÖ –£–±—Ä–∞–Ω—ã 2N –≤ intersections, –¥–æ–±–∞–≤–ª–µ–Ω compression –∏ Cache-Control –¥–ª—è /api/movies/:id |
| –¢–µ—Å—Ç—ã backend | 401, movies (—Ñ–æ—Ä–º–∞—Ç, invalid id) | ‚úÖ –°–¥–µ–ª–∞–Ω–æ; –æ—Å—Ç–∞—ë—Ç—Å—è: pairs, watchlist, auth success (–ø—Ä–∏ —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î) |
| –¢–µ—Å—Ç—ã frontend | –£—Ç–∏–ª–∏—Ç—ã, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ E2E | üî≤ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–µ—Å—Ç—å api.test) |
| –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫, –º–µ—Ç—Ä–∏–∫–∏, –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î | ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ errorHandler; –º–µ—Ç—Ä–∏–∫–∏/–º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ |
| CI: –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ | –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ –≤ GitHub Actions | ‚úÖ mikepenz/action-junit-report (Checks/Tests) |

---

## 5. –ù–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (–ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞)

1. ~~**–£–±—Ä–∞—Ç—å 2N –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ GET /api/watchlist/intersections**~~ **–°–¥–µ–ª–∞–Ω–æ.**  
   –í intersections —Ä–µ–π—Ç–∏–Ω–≥–∏ –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç—Å—è; –≤ –æ—Ç–≤–µ—Ç–µ –≤—Å–µ–≥–¥–∞ `my_rating`, `partner_rating`, `average_rating` = `null`.

2. ~~**–î–æ–±–∞–≤–∏—Ç—å middleware `compression`**~~ **–°–¥–µ–ª–∞–Ω–æ.**  
   –í Express –ø–æ–¥–∫–ª—é—á—ë–Ω `compression()` ‚Äî –æ—Ç–≤–µ—Ç—ã JSON —Å–∂–∏–º–∞—é—Ç—Å—è gzip. –î–ª—è GET /api/movies/:id –¥–æ–±–∞–≤–ª–µ–Ω –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Cache-Control: public, max-age=3600`.

3. **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ:** –≤ —Ç–∞–±–ª–∏—Ü—É watchlist (–∏–ª–∏ –∫—ç—à) –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ñ–∏–ª—å–º–∞ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å title, release_date, poster_path –∏–∑ TMDB, —á—Ç–æ–±—ã —Å–ø–∏—Å–∫–∏ –æ—Ç–¥–∞–≤–∞—Ç—å –±–µ–∑ N –≤—ã–∑–æ–≤–æ–≤ getMovieDetail; –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ ‚Äî –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏–ª–∏ TTL.

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ø—Ä–æ–¥–µ:** `max` –≤ pg.Pool –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–π –∑–∞–ø–∞—Å `max_connections` –≤ PostgreSQL —Å —É—á—ë—Ç–æ–º –¥—Ä—É–≥–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.

5. ~~**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**~~ **–°–¥–µ–ª–∞–Ω–æ.** –í errorHandler –¥–ª—è –Ω–µ-AppError –ª–æ–≥–∏—Ä—É—é—Ç—Å—è timestamp –∏ stack (–∏–ª–∏ message) —á–µ—Ä–µ–∑ `console.error`.

6. **–ò–Ω–¥–µ–∫—Å—ã –ë–î:** –≤ `schema.sql` —É–∂–µ –µ—Å—Ç—å `idx_ratings_user`, `idx_ratings_movie` –∏ UNIQUE(user_id, movie_id) –≤ ratings ‚Äî –¥–ª—è –±–∞—Ç—á-–∑–∞–ø—Ä–æ—Å–æ–≤ –≤–∏–¥–∞ `WHERE user_id = $1 AND movie_id = ANY($2)` —ç—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ.

---

## 6. –†–µ–∑—é–º–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ (29.01.2026)

–í—Å–µ —Ä–∞–Ω–µ–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ **–≤—ã–ø–æ–ª–Ω–µ–Ω—ã**. –ö—Ä–∏—Ç–∏—á–Ω—ã—Ö –∏–ª–∏ –≤—ã—Å–æ–∫–æ–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã—Ö –∑–∞–¥–∞—á –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å.

- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** intersections –±–µ–∑ 2N –∑–∞–ø—Ä–æ—Å–æ–≤, compression, Cache-Control –¥–ª—è movies ‚Äî –≤–Ω–µ–¥—Ä–µ–Ω–æ.
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** rate limit, helmet, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ errorHandler ‚Äî –≤–Ω–µ–¥—Ä–µ–Ω–æ.
- **CI:** —Ç–µ—Å—Ç—ã backend –∏ web, JUnit –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ Checks (Tests) ‚Äî –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ.

–î–∞–ª—å–Ω–µ–π—à–∏–µ —à–∞–≥–∏ ‚Äî –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏: –≤—Ä—É—á–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∏—Ç—å JWT_SECRET –∏ WEB_ORIGIN –≤ –ø—Ä–æ–¥–µ; –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ —Å –ë–î, E2E.

---

## 7. –ü–æ—Å—Ç–µ—Ä—ã (–∫–∞—Ä—Ç–∏–Ω–∫–∏ —Ñ–∏–ª—å–º–æ–≤): –ø–æ—á–µ–º—É –∏–Ω–æ–≥–¥–∞ –Ω–µ –≥—Ä—É–∑—è—Ç—Å—è

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**

1. **–ì–µ–æ–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ TMDB** ‚Äî TMDB –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø —Å IP –†–æ—Å—Å–∏–∏ –∏ –ë–µ–ª–∞—Ä—É—Å–∏ (–≤ —Ç.—á. `image.tmdb.org`). –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —ç—Ç–æ–º —Ä–µ–≥–∏–æ–Ω–µ, –∑–∞–ø—Ä–æ—Å—ã –∫ –∫–∞—Ä—Ç–∏–Ω–∫–∞–º –º–æ–≥—É—Ç –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å. –†–µ—à–µ–Ω–∏–µ: –∫–∞–∫ –¥–ª—è API ‚Äî –ø—Ä–æ–ø–∏—Å–∞—Ç—å –≤ `/etc/hosts` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ IP CDN –¥–ª—è `image.tmdb.org` (—Å–º. –Ω–∏–∂–µ), –∏–ª–∏ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫–∏ —á–µ—Ä–µ–∑ —Å–≤–æ–π –±—ç–∫–µ–Ω–¥.
2. **–°–±–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ TMDB** ‚Äî –µ—Å–ª–∏ `getConfiguration()` –Ω–µ –≤–µ—Ä–Ω—É–ª `base_url`, —Ä–∞–Ω—å—à–µ –≤ –æ—Ç–≤–µ—Ç —É—Ö–æ–¥–∏–ª –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π URL –ø–æ—Å—Ç–µ—Ä–æ–≤ (`w500/...`). –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –ø—Ä–∏ –ø—É—Å—Ç–æ–º `baseUrl` —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ–º `poster_path: null` –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä.
3. **–°–µ—Ç—å/404/403** ‚Äî —Ç–∞–π–º–∞—É—Ç, –±–ª–æ–∫ –ø–æ —Ä–µ—Ñ–µ—Ä–µ—Ä—É, —É–¥–∞–ª—ë–Ω–Ω—ã–π –ø–æ—Å—Ç–µ—Ä. –ù–∞ —Ñ—Ä–æ–Ω—Ç–µ –≤ `PosterImage` –¥–æ–±–∞–≤–ª–µ–Ω `onError`: –ø—Ä–∏ –æ—à–∏–±–∫–µ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä –≤–º–µ—Å—Ç–æ —Å–ª–æ–º–∞–Ω–Ω–æ–π –∏–∫–æ–Ω–∫–∏.

**–°–¥–µ–ª–∞–Ω–æ –≤ –∫–æ–¥–µ:** –≤ `posterPath()` –ø—Ä–∏ –ø—É—Å—Ç–æ–º `baseUrl` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `null`; –≤ `PosterImage` ‚Äî fallback –ø–æ `onError` –Ω–∞ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä.

---

### 7.1 –í–∞—Ä–∏–∞–Ω—Ç —Å –∑–∞–ø–∏—Å—å—é –≤ /etc/hosts –¥–ª—è image.tmdb.org

–ò–¥–µ—è —Ç–∞ –∂–µ, —á—Ç–æ –¥–ª—è API: –ø–æ–¥–º–µ–Ω–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –Ω–∞ IP CDN, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ —Ä–µ–∂–µ—Ç —Ç—Ä–∞—Ñ–∏–∫ –ø–æ —Ä–µ–≥–∏–æ–Ω—É.

**–®–∞–≥–∏:**

1. **–£–∑–Ω–∞—Ç—å —Ç–µ–∫—É—â–∏–π IP –¥–ª—è image.tmdb.org**  
   –° —Å–µ—Ä–≤–µ—Ä–∞ –≤ –†–§ `dig`/`nslookup` –º–æ–∂–µ—Ç –æ—Ç–¥–∞–≤–∞—Ç—å 127.0.0.1 –∏–ª–∏ ¬´–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π¬ª IP. –ü–æ—ç—Ç–æ–º—É IP –ª—É—á—à–µ –≤–∑—è—Ç—å –∏–∑ —Å—Ä–µ–¥—ã –±–µ–∑ –≥–µ–æ–±–ª–æ–∫–∞ (–ü–ö —Å VPN, –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–µ—Ä –∑–∞ —Ä—É–±–µ–∂–æ–º):
   ```bash
   dig image.tmdb.org +short
   # –∏–ª–∏
   nslookup image.tmdb.org 8.8.8.8
   ```
   –û–±—ã—á–Ω–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ IP CloudFront (–Ω–∞–ø—Ä–∏–º–µ—Ä `13.224.x.x`, `18.65.x.x`). –ë–µ—Ä—ë–º –æ–¥–∏–Ω –ª—é–±–æ–π.

2. **–ï—Å–ª–∏ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω hosts –¥–ª—è API**  
   –î–ª—è `api.themoviedb.org` —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä, `13.224.161.90`. –ú–æ–∂–Ω–æ **—Å–Ω–∞—á–∞–ª–∞ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Ç–æ—Ç –∂–µ IP** –¥–ª—è –∫–∞—Ä—Ç–∏–Ω–æ–∫:
   ```bash
   sudo tee -a /etc/hosts <<< '13.224.161.90 image.tmdb.org'
   ```
   –ï—Å–ª–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –Ω–∞—á–Ω—É—Ç –≥—Ä—É–∑–∏—Ç—å—Å—è ‚Äî –Ω–∏—á–µ–≥–æ –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–æ.

3. **–ï—Å–ª–∏ —Ç–æ—Ç –∂–µ IP –Ω–µ –ø–æ–¥–æ—à—ë–ª**  
   –î–æ–±–∞–≤–∏—Ç—å –≤ `/etc/hosts` IP, –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –≤ –ø.1 (—Å VPN/–∑–∞—Ä—É–±–µ–∂–Ω–æ–π –º–∞—à–∏–Ω—ã):
   ```bash
   sudo nano /etc/hosts
   # –¥–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É (–ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å —Å–≤–æ–π IP):
   # 13.224.222.78 image.tmdb.org
   ```

4. **–ü—Ä–æ–≤–µ—Ä–∫–∞**  
   –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
   ```bash
   ping -c 1 image.tmdb.org
   curl -sI "https://image.tmdb.org/t/p/w500/1abc.jpg" | head -5
   ```
   –î–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å —Ç–æ—Ç IP, —á—Ç–æ –≤ hosts, –∏ –ø–æ `curl` ‚Äî –æ—Ç–≤–µ—Ç 200 –∏–ª–∏ 404 (–≥–ª–∞–≤–Ω–æ–µ –Ω–µ —Ç–∞–π–º–∞—É—Ç –∏ –Ω–µ 403 –∏–∑-–∑–∞ –≥–µ–æ–±–ª–æ–∫–∞). –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –ø–æ—Å—Ç–µ—Ä–∞–º–∏ (Next.js –ø—Ä–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–∞—Ä—Ç–∏–Ω–æ–∫ —Ç—è–Ω–µ—Ç –∏—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞, —Ç.–µ. —Å –≤–∞—à–µ–≥–æ —Ö–æ—Å—Ç–∞).

**–í–∞–∂–Ω–æ:** IP —É CloudFront —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º –º–æ–≥—É—Ç –º–µ–Ω—è—Ç—å—Å—è. –ï—Å–ª–∏ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Å—è—Ü–µ–≤ –∫–∞—Ä—Ç–∏–Ω–∫–∏ —Å–Ω–æ–≤–∞ –ø–µ—Ä–µ—Å—Ç–∞–Ω—É—Ç –≥—Ä—É–∑–∏—Ç—å—Å—è ‚Äî –∑–∞–Ω–æ–≤–æ —Å–Ω—è—Ç—å IP (–ø.1) –∏ –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å –≤ `/etc/hosts`.

---

### 7.2 –ü–µ—Ä–µ–Ω–æ—Å –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ –∑–∞—Ä—É–±–µ–∂–Ω—ã–π —Å–µ—Ä–≤–µ—Ä ‚Äî —Ä–µ—à–∏—Ç –ª–∏ –ø—Ä–æ–±–ª–µ–º—É?

**–î–∞.** –ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ Next.js –∫—Ä—É—Ç—è—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ **–≤–Ω–µ –†–æ—Å—Å–∏–∏ –∏ –ë–µ–ª–∞—Ä—É—Å–∏**:

- **API** ‚Äî –∑–∞–ø—Ä–æ—Å—ã –∫ `api.themoviedb.org` –∏–¥—É—Ç —Å IP –∑–∞—Ä—É–±–µ–∂–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞, –≥–µ–æ–±–ª–æ–∫ TMDB –Ω–∞ –Ω–∏—Ö –Ω–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è.
- **–ö–∞—Ä—Ç–∏–Ω–∫–∏** ‚Äî –≤ –ø—Ä–æ–µ–∫—Ç–µ –¥–ª—è –ø–æ—Å—Ç–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Next.js (`next/image`), —Ç–æ –µ—Å—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ URL `https://image.tmdb.org/...` –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç **—Å–µ—Ä–≤–µ—Ä** (–ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã/–∫–∞—Ä—Ç–∏–Ω–∫–∏). –°–µ—Ä–≤–µ—Ä –∑–∞ —Ä—É–±–µ–∂–æ–º —Å–≤–æ–±–æ–¥–Ω–æ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ `image.tmdb.org`, –ø–æ–ª—É—á–∞–µ—Ç –∫–∞—Ä—Ç–∏–Ω–∫—É –∏ –æ—Ç–¥–∞—ë—Ç –µ—ë –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–∑ –†–§ –ø–æ–ª—É—á–∞–µ—Ç —É–∂–µ –≥–æ—Ç–æ–≤—É—é –∫–∞—Ä—Ç–∏–Ω–∫—É —Å –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞, –∞ –Ω–µ –Ω–∞–ø—Ä—è–º—É—é —Å TMDB, –ø–æ—ç—Ç–æ–º—É –≥–µ–æ–±–ª–æ–∫ –ø–æ –µ–≥–æ IP –Ω–µ –º–µ—à–∞–µ—Ç.

–ò—Ç–æ–≥–æ: –ø–µ—Ä–µ–Ω–æ—Å –Ω–∞ –∑–∞—Ä—É–±–µ–∂–Ω—ã–π —Ö–æ—Å—Ç–∏–Ω–≥ —Å–Ω–∏–º–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –≤ –æ–±—Ö–æ–¥–µ —á–µ—Ä–µ–∑ `/etc/hosts` –¥–ª—è –∏ API, –∏ –∫–∞—Ä—Ç–∏–Ω–æ–∫ (–ø—Ä–∏ —Ç–µ–∫—É—â–µ–π —Å—Ö–µ–º–µ —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ).
