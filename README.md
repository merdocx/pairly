# Pairly

Веб-приложение для пар: персональные списки «Буду смотреть», просмотр списка партнёра, страница пересечений, оценки (1–10) и автоматическое «Просмотрено».

**Платформы:**  
- **Веб** (MVP) — React/Next.js  
- **iOS, Android** (после MVP) — React Native (Expo)  
**Бэкенд:** отдельный сервер (веб-приложение на том же сервере)

---

## Документация

- **[Техническое задание (ТЗ)](./TZ_PAIRLY.md)** — полное описание функционала, требований, стека и этапов разработки.

---

## Стек (зафиксировано)

| Слой | Технология |
|------|------------|
| **Веб-приложение (MVP)** | React (Next.js) + TypeScript |
| **Мобильные приложения (после MVP)** | React Native (Expo) + TypeScript |
| **Бэкенд** | Node.js (Express) + TypeScript |
| **БД** | PostgreSQL |
| **Кеш** | Redis (кеш TMDB, сессии, rate limiting) |
| **API фильмов** | TMDB (The Movie Database) |

### TMDB

- Бесплатный API-ключ
- Поиск по названию, детали фильма, постеры, рейтинги
- ~40 req/s, при превышении — 429
- Документация: [developer.themoviedb.org](https://developer.themoviedb.org/docs)

---

## Основной функционал

### Авторизация
- Регистрация по email + пароль
- Вход по email + пароль
- Требования к паролю: минимум 8 символов, буква + цифра
- Данные: email (уникальный), пароль, имя (не уникальное, редактирование не предусмотрено в MVP)
- OAuth и восстановление пароля — не в MVP

### Пары
- Инвайт по коду пары (6 цифр, постоянный пока пара активна)
- Автоматическое присоединение после ввода кода (без подтверждения)
- Пользователь не может ввести код, если уже в паре
- Выход из пары (расформирование)

### Фильмы
- Поиск по названию через TMDB API
- Подгрузка при скролле (infinite scroll)
- Добавление в персональный список «Буду смотреть»

### Списки
- Персональные списки у каждого пользователя
- Просмотр своего списка, списка партнёра и пересечений
- Сортировка: по дате добавления, названию, рейтингу
- В списке партнёра — только непросмотренные партнёром фильмы
- В пересечениях — только фильмы, которые оба добавили и оба ещё не просмотрели

### Оценки и «Просмотрено»
- Оценки 1–10 звёзд (персональные)
- Оценку можно поставить только фильму из своего watchlist
- При постановке оценки фильм автоматически помечается как «Просмотрено»
- При снятии «Просмотрено» оценка удаляется
- Средняя оценка пары на странице пересечений
- При удалении фильма из watchlist удаляется вся связанная информация (оценка, «Просмотрено»)

### Пересечения
- Фильмы, которые оба добавили в свои списки и оба ещё не просмотрели
- Если хотя бы один из пары посмотрел фильм, он скрывается из пересечений
- Отображение оценок каждого и средней оценки пары

---

## Зафиксированные решения

1. **Платформы (MVP):** веб-приложение (SPA подход); мобильные приложения (iOS/Android) на более поздних этапах.
2. **Авторизация (MVP):** email + пароль (минимум 8 символов, буква + цифра); OAuth и восстановление пароля — не в MVP.
3. **Данные пользователя:** email (уникальный), пароль, имя (не уникальное, редактирование не предусмотрено в MVP).
4. **Списки:** персональные «Буду смотреть» у каждого; просмотр своего, партнёра и пересечений.
5. **Инвайт (MVP):** код пары — 6 цифр (0-9), постоянный пока пара активна; один показывает, второй вводит — автоматическое присоединение. Пользователь не может ввести код, если уже в паре.
6. **Оценки:** 1–10 звёзд; персонально, итог по паре — среднее. Оценку можно поставить только фильму из своего watchlist.
7. **«Просмотрено»:** при постановке оценки фильм автоматически помечается как «Просмотрено». При снятии «Просмотрено» оценка удаляется. В списке партнёра — только непросмотренные партнёром. В пересечениях — только непросмотренные обоими (если хотя бы один посмотрел, фильм скрывается).
8. **Выход из пары:** личные списки сохраняются; пересечения удаляются (экран недоступен).
9. **Бэкенд:** Express.js (не NestJS) для MVP.
10. **Хостинг:** веб-приложение и бэкенд на одном сервере.
11. **TMDB:** русский язык и регион, кеш с TTL (поиск — 1ч, детали — 24ч).

---

## Запуск проекта

### Требования

- Node.js 20+, npm
- PostgreSQL 15, Redis 7 (или Docker)

### Локально с Docker (PostgreSQL + Redis)

```bash
# Запустить БД и Redis
docker compose up -d

# Скопировать переменные и задать TMDB_API_KEY
cp .env.example .env
# Отредактировать .env: JWT_SECRET, TMDB_API_KEY

# Бэкенд
cd backend
cp ../.env .env   # или задать переменные в backend/.env
npm install
npm run db:migrate
npm run dev      # http://localhost:4000

# Веб (в другом терминале)
cd web
npm install
npm run dev      # http://localhost:3000
```

Переменные окружения описаны в `.env.example`. Для бэкенда обязательны: `DATABASE_URL`, `JWT_SECRET`, `TMDB_API_KEY`. Для веб — по желанию `NEXT_PUBLIC_API_URL` (по умолчанию `http://localhost:4000`).

### CI

GitHub Actions: при push/PR на `main` или `master` запускаются линт и сборка бэкенда и веб-приложения, а также тесты бэкенда (см. `.github/workflows/ci.yml`).

---

*Подробности — в [ТЗ](./TZ_PAIRLY.md).*
